<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ワイエムワークス – アンケートありがとうございました</title>
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','Segoe UI',Roboto,sans-serif;
  max-width:560px;
  margin:3rem auto;
  padding:0 32px;
  line-height:1.6;
  color:#1d1d1f;
  background:#fff;
  -webkit-font-smoothing: antialiased;
}

@media (prefers-color-scheme: dark) {
  body {
    color: #f5f5f7;
    background: #000;
  }
  
  textarea {
    color: #f5f5f7;
    background: #1c1c1e;
    border-color: #424245;
  }
  
  textarea:hover {
    border-color: #7a7a7c;
  }
  
  textarea:focus {
    background: #000;
  }
  
  button.secondary {
    background: #1c1c1e;
    color: #f5f5f7;
    border-color: #424245;
  }
  
  button.secondary:hover {
    background: #2c2c2e;
    border-color: #7a7a7c;
  }
  
  button:disabled {
    background: #1c1c1e;
    color: #8e8e93;
    border-color: #424245;
  }
  
  .high {
    background: rgba(52, 199, 89, 0.15);
    color: #f5f5f7;
  }
  
  .low {
    background: rgba(255, 149, 0, 0.15);
    color: #f5f5f7;
  }
  
  .low a {
    color: #0a84ff;
  }
  
  .helper-text {
    color: #a1a1a6;
  }
  
  .button-helper {
    color: #8e8e93;
  }
  
  .button-helper.enhanced {
    background: rgba(255, 255, 255, 0.05);
    border-color: #424245;
  }
  
  .benefit-note {
    background: rgba(255, 204, 0, 0.15);
    color: #f5f5f7;
  }
  
  .step-number {
    background: #2c2c2e;
    border-color: #424245;
  }
  
  .step-connector {
    background: #424245;
  }
}

textarea{
  width:100%;
  height:140px;
  margin-top:12px;
  margin-bottom:24px;
  border:1px solid #d2d2d7;
  border-radius:12px;
  padding:16px;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  font-size:16px;
  color:#1d1d1f;
  background:#fbfbfd;
  resize:vertical;
  outline:none;
  transition:border-color 0.2s ease, background-color 0.2s ease;
  box-sizing:border-box
}

textarea:hover{
  border-color:#86868b;
}

textarea:focus{
  border-color:#0071e3;
  background:#fff;
  box-shadow:0 0 0 4px rgba(0,113,227,0.1)
}

button{
  padding:12px 24px;
  font-size:16px;
  font-weight:500;
  cursor:pointer;
  border:none;
  border-radius:10px;
  display:inline-flex;
  align-items:center;
  gap:6px;
  transition:all 0.2s ease;
  min-height:44px;
  white-space: nowrap;
  margin-right: 12px;
}

button.primary{
  background:#0071e3;
  color:white
}

button.primary:hover{
  background:#0077ED;
  transform:translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,113,227,0.15);
}

button.primary:active{
  transform:translateY(0)
}

button.secondary{
  background:#f5f5f7;
  color:#86868b;
  border:1px solid #d2d2d7
}

button.secondary:hover{
  background:#e8e8ed;
  border-color:#86868b;
}

button.copied{
  background:#34c759;
  color:white
}

button.copied:hover{
  background:#30d158
}

button:disabled{
  background:#f5f5f7;
  color:#86868b;
  cursor:not-allowed;
  border:1px solid #d2d2d7;
  opacity: 0.6;
}

button:disabled:hover{
  background:#f5f5f7;
  transform:none;
  box-shadow: none;
}

h1{
  font-size:32px;
  font-weight:600;
  margin-bottom:8px;
  color:#1d1d1f;
  letter-spacing:-0.5px
}

small{
  color:#86868b;
  font-size:17px;
  font-weight:400
}

.high{
  color:#1d1d1f;
  font-size:17px;
  margin:24px 0 20px;
  line-height:1.5;
  font-weight:400;
  padding: 16px 20px;
  background: rgba(52, 199, 89, 0.08);
  border-radius: 12px;
}

.low{
  color:#1d1d1f;
  font-size:17px;
  margin:24px 0 20px;
  line-height:1.5;
  font-weight:400;
  padding: 16px 20px;
  background: rgba(255, 149, 0, 0.08);
  border-radius: 12px;
}

.low a {
  color:#0071e3;
  text-decoration:none;
  font-weight:400;
  transition: opacity 0.2s ease;
}

.low a:hover {
  opacity: 0.8;
  text-decoration: underline;
}

.hidden{
  display:none !important;
}

.helper-text{
  margin-top:16px;
  margin-bottom:0;
  color:#86868b;
  font-size:14px;
  font-weight:400;
}

.button-section {
  margin-top:0;
  margin-bottom:32px;
}

.button-helper {
  font-size: 13px;
  color: #86868b;
  margin-top: 8px;
  margin-left: 4px;
  display: none;
}

.button-helper.show {
  display: block;
}

.button-helper.enhanced {
  font-size: 14px;
  margin-top: 12px;
  margin-left: 0;
  padding: 12px 16px;
  background: rgba(0, 113, 227, 0.05);
  border: 1px solid rgba(0, 113, 227, 0.1);
  border-radius: 8px;
  text-align: center;
  font-weight: 500;
  transition: all 0.3s ease;
  opacity: 0;
  transform: translateY(-10px);
}

.button-helper.enhanced.show {
  opacity: 1;
  transform: translateY(0);
}

.button-helper.enhanced.highlight {
  background: rgba(0, 113, 227, 0.1);
  border-color: rgba(0, 113, 227, 0.2);
  animation: gentle-pulse 2s ease-in-out infinite;
}

@keyframes gentle-pulse {
  0%, 100% {
    background: rgba(0, 113, 227, 0.1);
  }
  50% {
    background: rgba(0, 113, 227, 0.15);
  }
}

.benefit-note {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 24px;
  padding: 12px 16px;
  background: rgba(255, 204, 0, 0.08);
  border-radius: 8px;
  font-size: 14px;
  color: #1d1d1f;
}

button:focus-visible,
textarea:focus-visible {
  outline: 2px solid #0071e3;
  outline-offset: 2px;
}

.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: #1d1d1f;
  color: #fff;
  padding: 12px 24px;
  border-radius: 8px;
  font-size: 15px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  opacity: 0;
  transition: all 0.3s ease;
  pointer-events: none;
}

.toast.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

@media (prefers-color-scheme: dark) {
  .toast {
    background: #f5f5f7;
    color: #1d1d1f;
  }
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(0, 113, 227, 0.4);
  }
  70% {
    box-shadow: 0 0 0 12px rgba(0, 113, 227, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(0, 113, 227, 0);
  }
}

button.primary.pulse {
  animation: pulse 2s infinite;
}

.step-indicator {
  display: none;
}

@media (max-width: 600px) {
  body {
    margin: 2rem auto;
    padding: 0 20px;
  }
  
  .button-section {
    margin-bottom: 24px;
  }
  
  button {
    display: block;
    width: 100%;
    margin-right: 0;
    margin-bottom: 12px;
  }
  
  button:last-of-type {
    margin-bottom: 0;
  }
  
  .button-helper {
    text-align: center;
    margin-left: 0;
  }
}
</style>
</head>
<body>
<h1>ワイエムワークス</h1>
<small>アンケートへのご協力、誠にありがとうございました。</small>

<p id="highMsg" class="high hidden">
  本日は愛車をお預けいただき、ありがとうございました！<br>
  お客様からの温かいお言葉が、スタッフの何よりの励みです。<br>
  よろしければ、レビューの投稿をお願いできますでしょうか。
</p>

<p id="lowMsg" class="low hidden">
  この度はご期待に添えず、申し訳ございませんでした。<br>
  お客様にご満足いただけるサービスを提供できなかったこと、心よりお詫び申し上げます。<br>
  いただいたご意見を真摯に受け止め、サービスの改善に努めてまいります。<br>
  もしよろしければ、具体的な改善点を <a href="mailto:admin@ymworks.com">admin@ymworks.com</a> までお聞かせください。
</p>

<p class="helper-text">
  投稿内容は自由に編集していただけます
</p>

<textarea id="txt"></textarea>

<div id="stepIndicator" class="step-indicator">
  <div class="step" id="step1">
    <span class="step-number">1</span>
    <span>入力</span>
  </div>
  <div class="step-connector"></div>
  <div class="step" id="step2">
    <span class="step-number">2</span>
    <span>コピー</span>
  </div>
  <div class="step-connector"></div>
  <div class="step" id="step3">
    <span class="step-number">3</span>
    <span>投稿</span>
  </div>
</div>

<div class="button-section">
  <button id="copy" class="primary">📋 レビューをコピー</button>
  <button id="gbtn" class="secondary" disabled>Googleクチコミを書く</button>
  <p id="btnHelper" class="button-helper">コピーした内容を貼り付けるだけ</p>
</div>

<div id="benefitNote" class="benefit-note hidden">
  🎁 投稿いただいたお客様は、ぜひスタッフにお声がけください
</div>

<div id="toast" class="toast"></div>

<script>
// Configuration
const PLACE_ID = 'ChIJi36eeSgoAWARJd6g5QUce6k';

// URL Parameters
const urlParams = new URLSearchParams(location.search);
const comment = decodeURIComponent(urlParams.get('comment') || '');
const rating = Number(urlParams.get('rating') || 0);

// DOM Elements
const textarea = document.getElementById('txt');
const copyBtn = document.getElementById('copy');
const googleBtn = document.getElementById('gbtn');
const highMessage = document.getElementById('highMsg');
const lowMessage = document.getElementById('lowMsg');
const toast = document.getElementById('toast');
const helperMessage = document.getElementById('btnHelper');
const benefitNote = document.getElementById('benefitNote');
const stepIndicator = document.getElementById('stepIndicator');
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const step3 = document.getElementById('step3');

let isCopied = false;

// Toast notification function
function showToast(message) {
  toast.textContent = message;
  toast.classList.add('show');
  setTimeout(() => {
    toast.classList.remove('show');
  }, 2000);
}

// Initialize page content
textarea.value = comment;

// Set initial button styles based on rating
if (rating < 4) {
  copyBtn.className = 'secondary';
}

// Display appropriate message based on rating
if (rating >= 4) {
  highMessage.classList.remove('hidden');
  benefitNote.classList.remove('hidden');
  stepIndicator.classList.add('show');
  step1.classList.add('completed');
  step2.classList.add('active');
} else {
  lowMessage.classList.remove('hidden');
  benefitNote.classList.add('hidden');
  benefitNote.style.display = 'none';
}

// Google review button click handler
googleBtn.onclick = () => {
  window.open('https://search.google.com/local/writereview?placeid=' + PLACE_ID, '_blank');
  
  if (rating >= 4) {
    showToast('Googleレビューページを開きました。コピーした内容を貼り付けてください！');
    
    if (helperMessage.classList.contains('enhanced')) {
      helperMessage.classList.add('highlight');
      helperMessage.innerHTML = '🎯 新しいタブでGoogleが開きました。貼り付けて投稿してください！';
      
      setTimeout(() => {
        helperMessage.classList.remove('highlight');
        helperMessage.innerHTML = '✨ コピーした内容をGoogleレビューに貼り付けるだけで完了です';
      }, 5000);
    }
  }
};

// Copy button click handler
copyBtn.onclick = () => {
  const textContent = textarea.value.trim();
  
  if (!textContent) {
    showToast('コピーするテキストがありません');
    return;
  }

  // Try modern clipboard API first
  if (navigator.clipboard) {
    navigator.clipboard.writeText(textContent)
      .then(() => {
        handleCopySuccess();
      })
      .catch(() => {
        fallbackCopy();
      });
  } else {
    fallbackCopy();
  }

  function handleCopySuccess() {
    isCopied = true;
    googleBtn.disabled = false;
    googleBtn.innerHTML = '→ Googleクチコミを書く';
    
    if (rating >= 4) {
      // High rating: Enhanced UI
      copyBtn.textContent = '✅ コピー完了';
      copyBtn.className = 'copied';
      googleBtn.className = 'primary pulse';
      helperMessage.classList.add('show', 'enhanced');
      helperMessage.innerHTML = '✨ コピーした内容をGoogleレビューに貼り付けるだけで完了です';
      step2.classList.add('completed');
      step3.classList.add('active');
      showToast('📋 レビューをクリップボードにコピーしました！');
    } else {
      // Low rating: Subdued UI
      copyBtn.textContent = '✅ コピー完了';
      copyBtn.className = 'secondary';
      googleBtn.className = 'secondary';
      showToast('レビューをコピーしました');
    }
    
    // Reset to "copied" state after 3 seconds
    setTimeout(() => {
      copyBtn.innerHTML = '✓ コピー済み';
      copyBtn.className = 'secondary';
    }, 3000);
  }

  function fallbackCopy() {
    textarea.select();
    try {
      const success = document.execCommand('copy');
      if (success) {
        handleCopySuccess();
      } else {
        showToast('コピーに失敗しました');
      }
    } catch (err) {
      showToast('コピーに失敗しました');
    }
  }
};

// Textarea input handler
textarea.addEventListener('input', function() {
  const hasContent = this.value.trim();
  
  if (rating >= 4 && hasContent) {
    step1.classList.add('completed');
    step2.classList.add('active');
  }
  
  // Reset copy button when content changes after copying
  if (isCopied && copyBtn.textContent === '✓ コピー済み') {
    copyBtn.innerHTML = '📋 レビューをコピー';
    copyBtn.className = rating >= 4 ? 'primary' : 'secondary';
    copyBtn.disabled = false;
    isCopied = false;
    
    // Hide helper message
    helperMessage.classList.remove('show', 'enhanced', 'highlight');
    
    // Reset step indicators for high ratings
    if (rating >= 4) {
      step2.classList.remove('completed');
      step3.classList.remove('active');
    }
  }
});
</script>
</body>
</html>
